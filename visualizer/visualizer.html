<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Dream Blob Visualizer</title>
<style>
html,body{margin:0;background:#02050a;overflow:hidden;color:#7fd8ff;font-family:system-ui}
#ui{position:fixed;bottom:10px;left:50%;transform:translateX(-50%);
background:rgba(0,15,30,.7);padding:8px 12px;border-radius:12px;
backdrop-filter:blur(8px);display:flex;gap:10px;align-items:center}
button{
background:#0a3a5a;border:none;color:#aee6ff;padding:6px 12px;
border-radius:8px;cursor:pointer}
button:hover{background:#125a88}
#progress{width:160px;height:6px;background:#062030;border-radius:9px;overflow:hidden}
#bar{height:100%;width:0%;background:#7fd9ff;transition:width .1s}
canvas{display:block}
#status{font-size:12px;opacity:.7}
</style>
</head>

<body>
<canvas id="c"></canvas>

<div id="ui">
<button id="load">Load</button>
<button id="play">â–¶</button>
<div id="progress"><div id="bar"></div></div>
<span id="status">No song loaded</span>
</div>

<audio id="audio" crossorigin="anonymous"></audio>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");
function resize(){canvas.width=innerWidth;canvas.height=innerHeight}
addEventListener("resize",resize);resize();

const audio = document.getElementById("audio");
const bar = document.getElementById("bar");
const status = document.getElementById("status");

let audioCtx, analyser, src, dataArray, started=false;

// SETUP AUDIO PIPELINE
function setup(){
  if(started) return;
  started=true;
  audioCtx = new (window.AudioContext||window.webkitAudioContext)();
  analyser = audioCtx.createAnalyser();
  analyser.fftSize = 256;
  dataArray = new Uint8Array(analyser.frequencyBinCount);
  src = audioCtx.createMediaElementSource(audio);
  src.connect(analyser);
  analyser.connect(audioCtx.destination);
}

// LOAD
document.getElementById("load").onclick=()=>{
 let i=document.createElement("input");
 i.type="file";
 i.accept="audio/*";
 i.onchange=e=>{
  const file=e.target.files[0];
  if(!file) return;
  audio.src=URL.createObjectURL(file);
  status.innerText=file.name;
  setup();
 };
 i.click();
};

// PLAY
document.getElementById("play").onclick=()=>{
 setup();
 audioCtx.resume();
 audio.paused ? audio.play() : audio.pause();
};

// PROGRESS BAR
audio.ontimeupdate=()=>{
 if(audio.duration){
   bar.style.width = (audio.currentTime/audio.duration*100)+"%";
 }
};

// BLOBS
const BLOBS=28;
const blobs=[];
for(let i=0;i<BLOBS;i++){
 blobs.push({
   r:50+Math.random()*120,
   a:i/BLOBS*Math.PI*2,
   s:0
 });
}

function draw(){
 ctx.clearRect(0,0,canvas.width,canvas.height);
 const cx=canvas.width/2, cy=canvas.height/2;

 let energy=0;
 if(analyser){
  analyser.getByteFrequencyData(dataArray);
  energy = dataArray.reduce((a,b)=>a+b)/dataArray.length/255;
 }

 blobs.forEach(b=>{
  b.s += (energy - b.s)*0.08;
  const pulse = b.r * (1 + b.s*1.3);
  const x = cx + Math.cos(b.a)*pulse;
  const y = cy + Math.sin(b.a)*pulse;

  const glow = ctx.createRadialGradient(x,y,2,x,y,20+energy*80);
  glow.addColorStop(0,"rgba(120,210,255,.9)");
  glow.addColorStop(1,"rgba(120,210,255,0)");

  ctx.fillStyle = glow;
  ctx.beginPath();
  ctx.arc(x,y,6+energy*12,0,Math.PI*2);
  ctx.fill();
 });

 requestAnimationFrame(draw);
}
draw();
</script>
</body>
</html>
